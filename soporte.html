<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MuzicMania - Soporte</title>
    <link rel="icon" type="image/png" href="assets/logo.png">
    <link rel="apple-touch-icon" href="assets/logo.png">
    <link rel="stylesheet" href="styles.css?v=221417">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .team-member {
            text-align: center;
            padding: var(--spacing-md);
        }

        .team-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--gradient-accent);
            margin: 0 auto var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            border: 3px solid var(--neon-blue);
        }

        .contact-form input,
        .contact-form textarea,
        .contact-form select {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--neon-blue);
            color: #fff;
            font-family: var(--font-body);
            font-size: 1.1rem;
            border-radius: 8px;
        }

        .contact-form textarea {
            min-height: 150px;
            resize: vertical;
        }

        .rating-stars {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: var(--spacing-sm) 0;
        }

        .rating-stars i {
            font-size: 2rem;
            color: #FFD700;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .rating-stars i:hover {
            transform: scale(1.2);
        }

        .review-card {
            background: rgba(0, 153, 255, 0.05);
            border-left: 4px solid var(--neon-blue);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            border-radius: 8px;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .contact-info-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: var(--spacing-sm);
            padding: 1rem;
            background: rgba(0, 153, 255, 0.05);
            border-radius: 8px;
        }

        .contact-info-item i {
            font-size: 1.5rem;
            color: var(--neon-cyan);
        }

        /* Character Counter & Indicators */
        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .char-limit {
            font-size: 0.75rem;
            color: #666;
            font-family: var(--font-header);
        }

        .char-limit.near-limit { color: var(--neon-pink); }
        .char-limit.at-limit { color: #ff0000; font-weight: bold; }

        /* Custom Select Synchronization */
        .custom-select-container {
            position: relative;
            width: 100%;
            margin-bottom: 1rem;
        }

        .custom-select-trigger {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--neon-blue);
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: var(--font-body);
            transition: 0.3s;
        }

        .custom-select-trigger:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.2);
        }

        .custom-select-options {
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            width: 100%;
            background: rgba(10, 10, 25, 0.98);
            border: 1px solid var(--neon-blue);
            border-radius: 8px;
            z-index: 100;
            display: none;
            max-height: 200px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .custom-select-options.active { display: block; }

        .custom-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .custom-option:hover {
            background: rgba(0, 212, 255, 0.1);
            color: var(--neon-cyan);
        }

        .custom-option.selected {
            background: rgba(0, 212, 255, 0.2);
            font-weight: bold;
        }

        .error-message {
            color: #ff4d4d;
            font-size: 0.8rem;
            margin-top: -0.5rem;
            margin-bottom: 1rem;
            display: none;
        }

        .form-group.has-error .custom-select-trigger,
        .form-group.has-error input,
        .form-group.has-error textarea {
            border-color: #ff4d4d;
            box-shadow: 0 0 10px rgba(255, 77, 77, 0.3);
        }

        /* Review System Enhancements */
        .review-sort-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 153, 255, 0.1);
        }

        .review-card {
            background: rgba(10, 10, 20, 0.4);
            border: 1px solid rgba(0, 153, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: 0.3s;
            position: relative;
        }

        .review-card:hover { border-color: var(--neon-blue); transform: translateX(5px); }

        .review-user-info { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .review-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-main); display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid var(--neon-blue); }

        .star-rating-input {
            font-size: 2.5rem;
            color: #333;
            cursor: pointer;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .star-rating-input i.active { color: #FFD700; text-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }

        .review-like-btn {
            background: rgba(255, 0, 128, 0.1);
            border: 1px solid rgba(255, 0, 128, 0.2);
            color: var(--neon-pink);
            padding: 4px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.3s;
        }

        .review-like-btn:hover, .review-like-btn.liked {
            background: var(--neon-pink);
            color: #fff;
            box-shadow: var(--glow-pink);
        }
        
        .badge {
            background: var(--neon-pink);
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            vertical-align: middle;
        }
        .ticket-item {
            padding: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: 0.3s;
        }
        .ticket-item:hover {
            background: rgba(0, 212, 255, 0.05);
        }
        .ticket-status {
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .status-pending { background: rgba(255, 166, 0, 0.2); color: orange; border: 1px solid orange; }
        .status-closed { background: rgba(0, 255, 0, 0.2); color: #0f0; border: 1px solid #0f0; }

        @keyframes rotateHologram {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loader-hologram {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top: 3px solid var(--neon-cyan);
            border-bottom: 3px solid var(--neon-pink);
            border-radius: 50%;
            animation: rotateHologram 1s linear infinite;
        }
    </style>
</head>
<body>
    
    <!-- Main -->
    <main class="container mt-3">
        <div class="section-header">
            <h1 class="section-title">Soporte</h1>
            <p>¿Tienes dudas o sugerencias? Ponte en contacto directamente con el creador del proyecto.</p>
        </div>

            <!-- Información del Equipo -->
            <section class="mt-3">
                <h2 class="text-center mb-2">Desarrollador</h2>
                <div class="contact-grid" style="grid-template-columns: 1fr; max-width: 400px; margin: 0 auto;">
                    <div class="card team-member">
                        <div class="team-avatar">👨‍💻</div>
                        <h3>Ciszuko Antony</h3>
                        <p style="color: var(--neon-sky); margin: 0.5rem 0;">Fundador & Desarrollador Principal</p>
                        <p style="font-size: 1rem; color: #888;">Liderando la visión técnica y creativa de MuzicMania.</p>
                    </div>
                </div>
            </section>

            <!-- Información de Contacto -->
            <section class="mt-3" id="contacto">
                <h2 class="text-center mb-2">Información de Contacto</h2>
                <div class="card">
                    <div class="contact-info-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <strong>Ubicación:</strong><br>
                            Caracas, Venezuela
                        </div>
                    </div>

                    <div class="contact-info-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <strong>Email Directo:</strong><br>
                            <a href="mailto:fplayersoffcial@gmail.com" style="color: var(--neon-cyan);">fplayersoffcial@gmail.com</a>
                        </div>
                    </div>

                    <div class="contact-info-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <strong>Teléfono:</strong><br>
                            04126858111 <span style="color: #888;">(VZLA)</span>
                        </div>
                    </div>

                    <div class="contact-info-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <strong>Horario de Atención:</strong><br>
                            Disponible para soporte y colaboración técnica.
                        </div>
                    </div>
                </div>
            </section>

            <!-- Formulario de Contacto -->
            <section class="mt-3">
                <div class="grid" style="grid-template-columns: 1.8fr 1fr; gap: 2rem;">
                    <!-- Formulario de Contacto -->
                    <div class="card" style="position: relative;">
                        <h2 class="mb-2">Envíanos un Mensaje</h2>
                        <form class="contact-form" id="contact-form" novalidate>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <div class="field-header">
                                        <label>Nombre Real</label>
                                        <span class="char-limit" id="limit-real-name">2-50</span>
                                    </div>
                                    <input type="text" id="contact-real-name" placeholder="Ej: Juan Pérez" required minlength="2" maxlength="50">
                                    <div class="error-message">Mínimo 2 caracteres requeridos.</div>
                                </div>
                                <div class="form-group">
                                    <div class="field-header">
                                        <label>Display Name</label>
                                        <span class="char-limit" id="limit-name">3-20</span>
                                    </div>
                                    <input type="text" id="contact-name" placeholder="Ej: RhythmMaster" required minlength="3" maxlength="20">
                                    <div class="error-message">Mínimo 3 caracteres requeridos.</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="field-header">
                                    <label>Email de Contacto</label>
                                    <span class="char-limit" id="limit-email">Máx 100</span>
                                </div>
                                <input type="email" id="contact-email" placeholder="tu@email.com" required maxlength="100">
                                <div class="error-message">Email inválido o vacío.</div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label>País</label>
                                    <div class="custom-select-container" id="container-country">
                                        <div class="custom-select-trigger" id="trigger-country">
                                            <span>Selecciona tu país</span>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="custom-select-options" id="options-country">
                                            <div class="custom-option" data-value="VE">🇻🇪 Venezuela</div>
                                            <div class="custom-option" data-value="AR">🇦🇷 Argentina</div>
                                            <div class="custom-option" data-value="CL">🇨🇱 Chile</div>
                                            <div class="custom-option" data-value="CO">🇨🇴 Colombia</div>
                                            <div class="custom-option" data-value="ES">🇪🇸 España</div>
                                            <div class="custom-option" data-value="MX">🇲🇽 México</div>
                                            <div class="custom-option" data-value="PE">🇵🇪 Perú</div>
                                            <div class="custom-option" data-value="US">🇺🇸 Estados Unidos</div>
                                            <div class="custom-option" data-value="OTHER">🌐 Otro</div>
                                        </div>
                                        <input type="hidden" id="contact-country" required>
                                    </div>
                                    <div class="error-message">Selecciona un país.</div>
                                </div>
                                <div class="form-group">
                                    <label>Asunto</label>
                                    <div class="custom-select-container" id="container-subject">
                                        <div class="custom-select-trigger" id="trigger-subject">
                                            <span>Selecciona un asunto</span>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="custom-select-options" id="options-subject">
                                            <div class="custom-option" data-value="support"><i class="fas fa-headset" style="color: var(--neon-blue);"></i> Soporte Técnico</div>
                                            <div class="custom-option" data-value="bug"><i class="fas fa-bug" style="color: var(--neon-pink);"></i> Reporte de Bug</div>
                                            <div class="custom-option" data-value="suggestion"><i class="fas fa-lightbulb" style="color: var(--neon-green);"></i> Sugerencia</div>
                                            <div class="custom-option" data-value="partnership"><i class="fas fa-handshake" style="color: var(--neon-cyan);"></i> Colaboración</div>
                                            <div class="custom-option" data-value="other"><i class="fas fa-ellipsis-h" style="color: #888;"></i> Otro</div>
                                        </div>
                                        <input type="hidden" id="contact-subject" required>
                                    </div>
                                    <div class="error-message">Selecciona un asunto.</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="field-header">
                                    <label>Mensaje</label>
                                    <span class="char-limit" id="limit-message">20 - 1000</span>
                                </div>
                                <textarea id="contact-message" placeholder="¿En qué podemos ayudarte?" style="min-height: 150px;" required minlength="20" maxlength="1000"></textarea>
                                <div class="error-message">Mínimo 20 caracteres requeridos.</div>
                            </div>
                            <button type="submit" class="btn btn-full" id="submit-btn" style="margin-top: 1rem;">
                                <i class="fas fa-paper-plane"></i> ENVIAR MENSAJE A SOPORTE
                            </button>
                        </form>
                        
                        <!-- Overlay de Envío -->
                        <div id="sending-overlay" style="display: none; position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); border-radius: 20px; z-index: 10; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
                            <div class="loader-hologram"></div>
                            <h3 style="color: var(--neon-cyan); margin-top: 1rem;">ENVIANDO DATOS AL SERVIDOR...</h3>
                            <div style="width: 80%; height: 4px; background: #333; margin-top: 1rem; border-radius: 2px; overflow: hidden;">
                                <div id="sending-progress" style="width: 0%; height: 100%; background: var(--gradient-main); box-shadow: 0 0 10px var(--neon-cyan);"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Mi Panel de Soporte (Solo Logueados) -->
                    <div class="card" id="support-panel" style="display: none;">
                        <h2 class="mb-2">Mis Tickets <span id="ticket-count" class="badge">0</span></h2>
                        <div id="tickets-list" style="max-height: 400px; overflow-y: auto;">
                            <!-- Tickets dinámicos -->
                        </div>
                        <div class="mt-2 text-center">
                            <p style="font-size: 0.9rem; color: #888;">Los tickets tardan 24-48h en procesarse.</p>
                        </div>
                    </div>

                    <!-- Panel de Atención Directa (Simplificado) -->
                    <div class="card" id="guest-panel">
                        <h3>Atención Directa</h3>
                        <p style="color: #888; font-size: 0.9rem; margin-bottom: 1.5rem;">Canales oficiales de @CiszukoAntony</p>
                        <ul style="list-style: none; margin-top: 1rem;">
                            <li style="margin-bottom: 1rem; display: flex; align-items: center; gap: 12px;">
                                <i class="fab fa-whatsapp" style="color: #25D366; font-size: 1.2rem;"></i>
                                <span><strong>WhatsApp:</strong> +58 412-6858111</span>
                            </li>
                            <li style="margin-bottom: 1rem; display: flex; align-items: center; gap: 12px;">
                                <i class="fab fa-x-twitter" style="color: #fff; font-size: 1.2rem;"></i>
                                <span><strong>X:</strong> @CiszukoAntony</span>
                            </li>
                            <li style="margin-bottom: 1rem; display: flex; align-items: center; gap: 12px;">
                                <i class="fab fa-discord" style="color: #5865F2; font-size: 1.2rem;"></i>
                                <span><strong>Discord:</strong> Comunidad MuzicMania</span>
                            </li>
                            <li style="margin-bottom: 1rem; display: flex; align-items: center; gap: 12px;">
                                <i class="fab fa-github" style="color: #fff; font-size: 1.2rem;"></i>
                                <span><strong>GitHub:</strong> @CiszukoAntony</span>
                            </li>
                            <li style="margin-bottom: 1rem; display: flex; align-items: center; gap: 12px;">
                                <i class="fab fa-reddit" style="color: #FF4500; font-size: 1.2rem;"></i>
                                <span><strong>Reddit:</strong> @CiszukoAntony</span>
                            </li>
                            <li style="margin-bottom: 1rem; display: flex; align-items: center; gap: 12px;">
                                <i class="fab fa-youtube" style="color: #FF0000; font-size: 1.2rem;"></i>
                                <span><strong>YouTube:</strong> @CiszukoAntony</span>
                            </li>
                            <li style="margin-bottom: 1rem; display: flex; align-items: center; gap: 12px;">
                                <i class="fab fa-instagram" style="color: #E4405F; font-size: 1.2rem;"></i>
                                <span><strong>Instagram:</strong> @CiszukoAntony</span>
                            </li>
                            <li style="margin-bottom: 1rem; display: flex; align-items: center; gap: 12px;">
                                <i class="fab fa-tiktok" style="color: #00f2ea; font-size: 1.2rem;"></i>
                                <span><strong>TikTok:</strong> @CiszukoAntony</span>
                            </li>
                            <li style="margin-bottom: 1rem; display: flex; align-items: center; gap: 12px;">
                                <i class="fab fa-twitch" style="color: #9146FF; font-size: 1.2rem;"></i>
                                <span><strong>Twitch:</strong> @CiszukoAntony</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Valoración y Reseñas -->
            <section class="mt-5">
                <h2 class="section-title-md">Opinión de la Comunidad</h2>
                
                <div class="grid" style="grid-template-columns: 1fr 1.5fr; gap: 3rem;">
                    <!-- Panel de Calificación -->
                    <div class="card" style="height: fit-content;">
                        <h3 class="mb-2">Danos tu Valoración</h3>
                        <div id="review-form-container">
                            <div class="star-rating-input" id="rating-input-stars">
                                <i class="fas fa-star" data-value="1"></i>
                                <i class="fas fa-star" data-value="2"></i>
                                <i class="fas fa-star" data-value="3"></i>
                                <i class="fas fa-star" data-value="4"></i>
                                <i class="fas fa-star" data-value="5"></i>
                            </div>
                            <input type="hidden" id="rating-value" value="0">
                            
                            <div class="form-group mt-2">
                                <label>Tu Reseña</label>
                                <textarea id="review-text" placeholder="¿Qué te ha parecido MuzicMania?" style="min-height: 100px;"></textarea>
                            </div>
                            
                            <div id="auth-warning-review" style="display: none; padding: 1rem; background: rgba(255, 166, 0, 0.1); border: 1px solid orange; color: orange; border-radius: 8px; margin-bottom: 1rem; font-size: 0.9rem;">
                                <i class="fas fa-exclamation-triangle"></i> Debes <strong>iniciar sesión</strong> para publicar una valoración.
                            </div>

                            <button class="btn btn-full" id="submit-review-btn">
                                <i class="fas fa-star"></i> PUBLICAR VALORACIÓN
                            </button>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <p style="color: #888; margin-bottom: 0.5rem;">Promedio Global</p>
                            <span style="color: var(--neon-cyan); font-size: 3rem; font-weight: 900; font-family: var(--font-header);">4.8</span>
                            <div class="rating-stars" style="justify-content: center; font-size: 1.2rem; margin-top: 0.5rem;">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                            </div>
                            <p style="color: #666; font-size: 0.85rem; margin-top: 0.5rem;">Basado en 1,247 transmisiones</p>
                        </div>
                    </div>

                    <!-- Lista de Reseñas -->
                    <div>
                        <div class="review-sort-bar">
                            <h3 style="margin: 0; font-size: 1.2rem;">Reseñas Recientes</h3>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="font-size: 0.8rem; color: #888;">Ordenar por:</span>
                                <select id="review-sort" style="background: transparent; border: 1px solid var(--neon-blue); color: #fff; padding: 4px 10px; border-radius: 5px; font-size: 0.85rem;">
                                    <option value="newest" selected>Más Nuevas</option>
                                    <option value="highest">Mejor Valoradas</option>
                                    <option value="popular">Más Útiles (Likes)</option>
                                </select>
                            </div>
                        </div>

                        <div id="reviews-container">
                            <!-- Reseñas Renderizadas Dinámicamente -->
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Layout System -->
    <script src="layout.js?v=221417"></script>

    <script>
        // --- Gestión de Tickets (Mock) ---
        const SupportTickets = {
            storageKey: 'muzicmania_tickets',
            getAll: function() {
                return JSON.parse(localStorage.getItem(this.storageKey) || '[]');
            },
            save: function(ticket) {
                const tickets = this.getAll();
                tickets.unshift(ticket);
                localStorage.setItem(this.storageKey, JSON.stringify(tickets));
            },
            render: function() {
                const list = document.getElementById('tickets-list');
                const count = document.getElementById('ticket-count');
                const tickets = this.getAll();
                
                if (!list) return;
                
                count.textContent = tickets.length;
                
                if (tickets.length === 0) {
                    list.innerHTML = `<p style="text-align: center; color: #555; padding: 2rem;">No tienes tickets activos.</p>`;
                    return;
                }

                list.innerHTML = tickets.map(t => `
                    <div class="ticket-item">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="color: var(--neon-blue); font-weight: bold;">#${t.id}</span>
                            <span class="ticket-status status-${t.status.toLowerCase()}">${t.status}</span>
                        </div>
                        <div style="font-size: 0.95rem;">${t.subject}</div>
                        <div style="font-size: 0.8rem; color: #888;">${new Date(t.date).toLocaleDateString()}</div>
                    </div>
                `).join('');
            }
        };

        // --- Custom Dropdown Logic ---
        function setupCustomDropdown(id) {
            const container = document.getElementById(`container-${id}`);
            const trigger = document.getElementById(`trigger-${id}`);
            const options = document.getElementById(`options-${id}`);
            const input = document.getElementById(`contact-${id}`);

            trigger.addEventListener('click', () => {
                options.classList.toggle('active');
            });

            options.querySelectorAll('.custom-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    const val = opt.getAttribute('data-value');
                    input.value = val;
                    trigger.querySelector('span').innerHTML = opt.innerHTML;
                    
                    options.querySelectorAll('.custom-option').forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                    options.classList.remove('active');
                    
                    // Clear error on select
                    container.parentElement.classList.remove('has-error');
                    container.parentElement.querySelector('.error-message').style.display = 'none';
                });
            });

            // Close when clicking outside
            document.addEventListener('click', (e) => {
                if (container && !container.contains(e.target)) {
                    options.classList.remove('active');
                }
            });
        }

        // Dropdowns and counters will be initialized in initializeContactPage

        // --- Character Counter Logic ---
        function setupCharCounter(id, limitId, min, max) {
            const input = document.getElementById(id);
            const limit = document.getElementById(limitId);
            if (!input || !limit) return;

            const update = () => {
                const len = input.value.length;
                // Show current vs range (with spaces for better readability)
                const rangeLabel = (min > 0) ? `${min} - ${max}` : `Máx ${max}`;
                limit.textContent = `${len} / ${rangeLabel}`;

                if (len < min || len >= max) {
                    limit.className = 'char-limit at-limit';
                } else if (len > max * 0.8) {
                    limit.className = 'char-limit near-limit';
                } else {
                    limit.className = 'char-limit';
                }
            };

            input.addEventListener('input', update);
            input.addEventListener('keyup', update); // Backup for some browsers
            update(); 
        }


        // --- Form Interaction & Validation ---
        document.getElementById('contact-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            let hasError = false;
            const inputs = this.querySelectorAll('input[required], textarea[required]');

            inputs.forEach(input => {
                const group = input.closest('.form-group');
                const error = group.querySelector('.error-message');
                let valid = input.checkValidity();

                if (input.type === 'hidden' && !input.value) {
                    valid = false;
                }

                if (!valid) {
                    group.classList.add('has-error');
                    if (error) error.style.display = 'block';
                    hasError = true;
                } else {
                    group.classList.remove('has-error');
                    if (error) error.style.display = 'none';
                }
            });

            if (hasError) return;
            
            const overlay = document.getElementById('sending-overlay');
            const progress = document.getElementById('sending-progress');
            const submitBtn = document.getElementById('submit-btn');
            
            overlay.style.display = 'flex';
            submitBtn.disabled = true;
            
            let p = 0;
            const interval = setInterval(() => {
                p += Math.random() * 20;
                if (p >= 100) {
                    p = 100;
                    clearInterval(interval);
                    
                    SupportTickets.save({
                        id: Math.random().toString(36).substr(2, 6).toUpperCase(),
                        subject: document.getElementById('trigger-subject').querySelector('span').innerText,
                        date: new Date().toISOString(),
                        status: 'PENDING'
                    });

                    setTimeout(() => {
                        overlay.style.display = 'none';
                        alert('¡Mensaje Enviado! Tu solicitud ha sido enviada al soporte técnico.');
                        this.reset();
                        // Trigger input events to refresh counters
                        this.querySelectorAll('input, textarea').forEach(i => i.dispatchEvent(new Event('input')));
                        
                        document.getElementById('trigger-country').querySelector('span').innerText = 'Selecciona tu país';
                        document.getElementById('trigger-subject').querySelector('span').innerText = 'Selecciona un asunto';
                        submitBtn.disabled = false;
                        progress.style.width = '0%';
                        SupportTickets.render();
                    }, 500);
                }
                progress.style.width = p + '%';
            }, 300);
        });

        // --- Advanced Review System ---
        const ReviewSystem = {
            storageKey: 'muzicmania_reviews',
            reviews: [
                { id: 1, user: 'CyberGamer42', initials: 'CG', rating: 5, text: '¡Increíble juego! Los visuales son espectaculares.', date: '2026-01-28T10:00:00Z', likes: 45 },
                { id: 2, user: 'NeonQueen', initials: 'NQ', rating: 4, text: 'Me encanta la estética futurista, las canciones son geniales.', date: '2026-01-25T15:30:00Z', likes: 12 },
                { id: 3, user: 'RhythmMaster', initials: 'RM', rating: 5, text: 'La detección de teclas es perfecta. Súper satisfactorio.', date: '2026-01-20T09:00:00Z', likes: 89 },
                { id: 4, user: 'SynthWaveKid', initials: 'SK', rating: 3, text: 'El arte es genial pero necesito más variedad de canciones.', date: '2026-01-15T12:00:00Z', likes: 5 },
                { id: 5, user: 'DigitalDreamer', initials: 'DD', rating: 5, text: 'MuzicMania ha redefinido lo que espero de un juego de ritmo de navegador.', date: '2026-01-29T18:45:00Z', likes: 32 }
            ],

            init: function() {
                this.render();
                this.setupStars();
                this.setupSorting();
                this.setupSubmit();
            },

            setupStars: function() {
                const stars = document.querySelectorAll('#rating-input-stars i');
                const valInput = document.getElementById('rating-value');
                
                stars.forEach(star => {
                    star.addEventListener('mouseover', () => {
                        const val = parseInt(star.getAttribute('data-value'));
                        this.highlightStars(val);
                    });
                    
                    star.addEventListener('mouseout', () => {
                        const currentVal = parseInt(valInput.value);
                        this.highlightStars(currentVal);
                    });
                    
                    star.addEventListener('click', () => {
                        valInput.value = star.getAttribute('data-value');
                        this.highlightStars(parseInt(valInput.value));
                    });
                });
            },

            highlightStars: function(count) {
                const stars = document.querySelectorAll('#rating-input-stars i');
                stars.forEach(s => {
                    const v = parseInt(s.getAttribute('data-value'));
                    s.classList.toggle('active', v <= count);
                });
            },

            setupSorting: function() {
                document.getElementById('review-sort').addEventListener('change', (e) => {
                    this.render(e.target.value);
                });
            },

            setupSubmit: function() {
                const btn = document.getElementById('submit-review-btn');
                const warning = document.getElementById('auth-warning-review');

                const checkAuth = () => {
                    const user = AuthSystem.getCurrentUser();
                    if (!user) {
                        btn.style.opacity = '0.5';
                        warning.style.display = 'block';
                    } else {
                        btn.style.opacity = '1';
                        warning.style.display = 'none';
                    }
                };

                setInterval(checkAuth, 1000);

                btn.addEventListener('click', () => {
                    const user = AuthSystem.getCurrentUser();
                    if (!user) {
                        AuthSystem.openModal('login');
                        return;
                    }

                    const rating = parseInt(document.getElementById('rating-value').value);
                    const text = document.getElementById('review-text').value;

                    if (rating === 0) {
                        alert('Por favor, selecciona una puntuación.');
                        return;
                    }

                    if (text.length < 5) {
                        alert('Tu reseña debe ser un poco más larga.');
                        return;
                    }

                    const newReview = {
                        id: Date.now(),
                        user: user.username,
                        initials: user.initials,
                        rating: rating,
                        text: text,
                        date: new Date().toISOString(),
                        likes: 0
                    };

                    this.reviews.unshift(newReview);
                    this.render();
                    
                    document.getElementById('rating-value').value = 0;
                    document.getElementById('review-text').value = '';
                    this.highlightStars(0);
                    alert('¡Gracias por tu valoración!');
                });
            },

            render: function(sortBy = 'newest') {
                const container = document.getElementById('reviews-container');
                let sorted = [...this.reviews];

                if (sortBy === 'highest') sorted.sort((a,b) => b.rating - a.rating);
                else if (sortBy === 'popular') sorted.sort((a,b) => b.likes - a.likes);
                else sorted.sort((a,b) => new Date(b.date) - new Date(a.date));

                container.innerHTML = sorted.map(r => `
                    <div class="review-card" data-id="${r.id}">
                        <div class="review-user-info">
                            <div class="review-avatar">${r.initials}</div>
                            <div>
                                <strong style="color: var(--neon-cyan);">${r.user}</strong>
                                <div class="rating-stars" style="font-size: 0.8rem; justify-content: flex-start;">
                                    ${Array(5).fill(0).map((_, i) => `<i class="${i < r.rating ? 'fas' : 'far'} fa-star" style="color: #FFD700;"></i>`).join('')}
                                </div>
                            </div>
                            <span style="margin-left: auto; color: #666; font-size: 0.8rem;">${this.formatDate(r.date)}</span>
                        </div>
                        <p style="color: #ddd; line-height: 1.6; margin-bottom: 1rem;">"${r.text}"</p>
                        <div style="display: flex; gap: 10px;">
                            <button class="review-like-btn" onclick="ReviewSystem.handleLike(this, ${r.id})">
                                <i class="fas fa-heart"></i> <span class="like-count">${r.likes}</span>
                            </button>
                        </div>
                    </div>
                `).join('');
            },

            formatDate: function(dateStr) {
                const d = new Date(dateStr);
                const now = new Date();
                const diff = (now - d) / 1000;
                if (diff < 3600) return 'Hace poco';
                if (diff < 86400) return 'Hoy';
                return d.toLocaleDateString();
            },

            handleLike: function(btn, id) {
                const review = this.reviews.find(r => r.id === id);
                if (!review) return;

                if (btn.classList.contains('liked')) {
                    review.likes--;
                    btn.classList.remove('liked');
                } else {
                    review.likes++;
                    btn.classList.add('liked');
                }
                btn.querySelector('.like-count').textContent = review.likes;
            }
        };

        // --- Auth Integration & Initializations ---
        let contactInitialized = false;

        function initializeContactPage() {
            if (typeof AuthSystem === 'undefined') {
                setTimeout(initializeContactPage, 100);
                return;
            }

            if (!contactInitialized) {
                // 1. Initialize Form Components FIRST
                setupCustomDropdown('country');
                setupCustomDropdown('subject');
                setupCharCounter('contact-real-name', 'limit-real-name', 2, 50);
                setupCharCounter('contact-name', 'limit-name', 3, 20);
                setupCharCounter('contact-email', 'limit-email', 5, 100);
                setupCharCounter('contact-message', 'limit-message', 20, 1000);
                
                ReviewSystem.init();
                contactInitialized = true;
                console.log("MuzicMania Contact System: Componentes Listos");
            }

            // 2. Auth Logic (Pre-fill)
            const user = AuthSystem.getCurrentUser();
            const guestPanel = document.getElementById('guest-panel');
            const supportPanel = document.getElementById('support-panel');

            if (user) {
                const name = document.getElementById('contact-name');
                const realName = document.getElementById('contact-real-name');
                const email = document.getElementById('contact-email');
                
                if (name) name.value = user.username;
                if (realName) realName.value = user.username;
                if (email) email.value = user.email || "usuario@muzicmania.game";
                
                // Trigger updates AFTER listeners are attached
                [name, realName, email].forEach(i => {
                    if (i) i.dispatchEvent(new Event('input'));
                });

                if (guestPanel) guestPanel.style.display = 'none';
                if (supportPanel) supportPanel.style.display = 'block';
                SupportTickets.render();
            } else {
                if (guestPanel) guestPanel.style.display = 'block';
                if (supportPanel) supportPanel.style.display = 'none';
            }
        }

        window.addEventListener('load', initializeContactPage);
        window.addEventListener('authChange', initializeContactPage);

    </script>
    <script src="auth.js?v=2"></script>
    <script src="utils.js?v=221417"></script>
    <script src="search.js?v=1"></script>
    <script src="navigation.js?v=221417"></script>
</body>
</html>
