<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MuzicMania - Soporte</title>
    <link rel="icon" type="image/png" href="assets/logo.png">
    <link rel="apple-touch-icon" href="assets/logo.png">
    <link rel="stylesheet" href="styles.css?v=UPDATE_SEARCH_REFACTOR_V1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .team-member {
            text-align: center;
            padding: var(--spacing-md);
        }

        .team-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--gradient-accent);
            margin: 0 auto var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            border: 3px solid var(--neon-blue);
        }

        .contact-form input,
        .contact-form textarea,
        .contact-form select {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--neon-blue);
            color: #fff;
            font-family: var(--font-body);
            font-size: 1.1rem;
            border-radius: 8px;
        }

        .contact-form textarea {
            min-height: 150px;
            resize: vertical;
        }

        .rating-stars {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: var(--spacing-sm) 0;
        }

        .rating-stars i {
            font-size: 2rem;
            color: #FFD700;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .rating-stars i:hover {
            transform: scale(1.2);
        }

        .review-card {
            background: rgba(0, 153, 255, 0.05);
            border-left: 4px solid var(--neon-blue);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            border-radius: 8px;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .contact-info-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: var(--spacing-sm);
            padding: 1rem;
            background: rgba(0, 153, 255, 0.05);
            border-radius: 8px;
        }

        .contact-info-item i {
            font-size: 1.5rem;
            color: var(--neon-cyan);
        }

        /* Character Counter & Indicators */
        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .char-limit {
            font-size: 0.75rem;
            color: #666;
            font-family: var(--font-header);
        }

        .char-limit.near-limit { color: var(--neon-pink); }
        .char-limit.at-limit { color: #ff0000; font-weight: bold; }

        /* --- Estilos Premium de Inputs --- */
        input[type="text"],
        input[type="email"],
        textarea,
        .custom-select-trigger {
            width: 100%;
            background: rgba(0, 0, 0, 0.3) !important;
            border: 1px solid rgba(0, 212, 255, 0.2) !important;
            border-radius: 12px !important;
            color: #fff !important;
            padding: 1rem !important;
            font-family: var(--font-body) !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            outline: none !important;
            font-size: 1rem !important;
        }

        input:focus,
        textarea:focus,
        .custom-select-container.active .custom-select-trigger {
            border-color: var(--neon-cyan) !important;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4), inset 0 0 10px rgba(0, 212, 255, 0.1) !important;
            background: rgba(0, 212, 255, 0.08) !important;
        }

        /* --- Panel de Disponibilidad --- */
        .availability-card {
            background: rgba(0, 212, 255, 0.03);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .availability-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan);
        }

        .avail-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avail-item i {
            font-size: 1.5rem;
            color: var(--neon-cyan);
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .avail-info h4 {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }

        .avail-info p {
            font-size: 1rem;
            color: #fff;
            font-weight: bold;
            margin: 0;
        }

        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .field-header label {
            margin: 0;
            font-weight: 600;
            color: #eee;
        }

        .char-limit {
            font-size: 0.75rem;
            color: #666;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        .char-limit.near-limit { color: #ffaa00; }
        .char-limit.error { color: #ff4d4d; }
        .char-limit.valid { color: var(--neon-green); }

        /* Dropdown Personalizado Mejorado */
        .custom-select-container {
            position: relative;
            width: 100%;
        }

        .custom-select-options {
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            width: 100%;
            background: rgba(10, 10, 25, 0.98);
            border: 1px solid var(--neon-blue);
            border-radius: 12px;
            z-index: 1000;
            display: none;
            max-height: 250px;
            overflow-y: auto;
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 5px;
        }

        .custom-select-container.active .custom-select-options {
            display: block;
            animation: dropdownFade 0.3s ease;
        }

        @keyframes dropdownFade {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .custom-option {
            padding: 12px 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ccc;
            font-size: 0.9rem;
        }

        .custom-option:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #fff;
        }

        .custom-option.selected {
            background: rgba(0, 212, 255, 0.2);
            color: var(--neon-cyan);
            font-weight: bold;
        }

        .error-message {
            color: #ff4d4d;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: bold;
        }

        .form-group.has-error .custom-select-trigger,
        .form-group.has-error input,
        .form-group.has-error textarea {
            border-color: #ff4d4d !important;
            box-shadow: 0 0 10px rgba(255, 77, 77, 0.2) !important;
        }

        /* Review System Enhancements */
        .review-sort-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 153, 255, 0.1);
        }

        .review-card {
            background: rgba(10, 10, 20, 0.4);
            border: 1px solid rgba(0, 153, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: 0.3s;
            position: relative;
        }

        .review-card:hover { border-color: var(--neon-blue); transform: translateX(5px); }

        .review-user-info { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .review-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-main); display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid var(--neon-blue); }

        .star-rating-input {
            font-size: 2.5rem;
            color: #333;
            cursor: pointer;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .star-rating-input i.active { color: #FFD700; text-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }

        .review-like-btn {
            background: rgba(255, 0, 128, 0.1);
            border: 1px solid rgba(255, 0, 128, 0.2);
            color: var(--neon-pink);
            padding: 4px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.3s;
        }

        .review-like-btn:hover, .review-like-btn.liked {
            background: var(--neon-pink);
            color: #fff;
            box-shadow: var(--glow-pink);
        }
        
        .badge {
            background: var(--neon-pink);
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            vertical-align: middle;
        }
        .ticket-item {
            padding: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: 0.3s;
        }
        .ticket-item:hover {
            background: rgba(0, 212, 255, 0.05);
        }
        .ticket-status {
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .status-pending { background: rgba(255, 166, 0, 0.2); color: orange; border: 1px solid orange; }
        .status-closed { background: rgba(0, 255, 0, 0.2); color: #0f0; border: 1px solid #0f0; }

        @keyframes rotateHologram {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loader-hologram {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top: 3px solid var(--neon-cyan);
            border-bottom: 3px solid var(--neon-pink);
            border-radius: 50%;
            animation: rotateHologram 1s linear infinite;
        }
    </style>
</head>
<body>
    
    <!-- Main -->
    <main class="container mt-3">
        <div class="section-header">
            <h1 class="section-title">Soporte</h1>
            <p>Atención directa y personalizada para garantizar tu mejor experiencia en MuzicMania.</p>
        </div>

        <!-- Panel de Disponibilidad -->
        <div class="availability-card mt-3">
            <div class="avail-item">
                <i class="fas fa-clock"></i>
                <div class="avail-info">
                    <h4>Disponibilidad</h4>
                    <p>24/7 (Soporte Global)</p>
                </div>
            </div>
            <div class="avail-item">
                <i class="fas fa-bolt"></i>
                <div class="avail-info">
                    <h4>Tiempo de Respuesta</h4>
                    <p>2h - 48h Máximo</p>
                </div>
            </div>
            <div class="avail-item">
                <i class="fas fa-shield-alt"></i>
                <div class="avail-info">
                    <h4>Prioridad</h4>
                    <p>Usuarios Registrados</p>
                </div>
            </div>
            <div class="avail-item">
                <i class="fas fa-globe"></i>
                <div class="avail-info">
                    <h4>Región Central</h4>
                    <p>Latinoamérica (VET)</p>
                </div>
            </div>
        </div>


            <!-- Formulario de Contacto -->
            <section class="mt-3">
                <div class="grid" style="grid-template-columns: 1fr; max-width: 800px; margin: 0 auto; gap: 2rem;">
                    <!-- Formulario de Contacto -->
                    <div class="card" style="position: relative;">
                        <h2 class="mb-2">Envíanos un Mensaje</h2>
                        <form class="contact-form" id="contact-form" novalidate>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                <div class="field-header">
                                    <label>Nombre Real</label>
                                    <span class="char-limit" id="limit-real-name">0 / 50</span>
                                </div>
                                <input type="text" id="contact-real-name" placeholder="Ej: Juan Pérez" required maxlength="50">
                                <div class="error-message">Mínimo 2 caracteres requeridos.</div>
                            </div>
                                <div class="form-group">
                                    <div class="field-header">
                                        <label>Nombre de Usuario</label>
                                        <span class="char-limit" id="limit-name">0 / 20</span>
                                    </div>
                                    <input type="text" id="contact-name" placeholder="Tu usuario en el juego" required maxlength="20">
                                    <div class="error-message">Mínimo 3 caracteres requeridos.</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="field-header">
                                    <label>Email de Contacto</label>
                                    <span class="char-limit" id="limit-email">0 / 100</span>
                                </div>
                                <input type="email" id="contact-email" placeholder="tu@email.com" required maxlength="100">
                                <div class="error-message">Email inválido o vacío.</div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label>País</label>
                                    <div class="custom-select-container" id="container-country">
                                        <div class="custom-select-trigger" id="trigger-country">
                                            <span>Selecciona tu país</span>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="custom-select-options" id="options-country">
                                            <div class="custom-option" data-value="VE">🇻🇪 Venezuela</div>
                                            <div class="custom-option" data-value="AR">🇦🇷 Argentina</div>
                                            <div class="custom-option" data-value="CL">🇨🇱 Chile</div>
                                            <div class="custom-option" data-value="CO">🇨🇴 Colombia</div>
                                            <div class="custom-option" data-value="ES">🇪🇸 España</div>
                                            <div class="custom-option" data-value="MX">🇲🇽 México</div>
                                            <div class="custom-option" data-value="PE">🇵🇪 Perú</div>
                                            <div class="custom-option" data-value="US">🇺🇸 Estados Unidos</div>
                                            <div class="custom-option" data-value="OTHER">🌐 Otro</div>
                                        </div>
                                        <input type="hidden" id="contact-country" required>
                                    </div>
                                    <div class="error-message">Selecciona un país.</div>
                                </div>
                                <div class="form-group">
                                    <label>Asunto</label>
                                    <div class="custom-select-container" id="container-subject">
                                        <div class="custom-select-trigger" id="trigger-subject">
                                            <span>Selecciona un asunto</span>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                        <div class="custom-select-options" id="options-subject">
                                            <div class="custom-option" data-value="support"><i class="fas fa-headset" style="color: var(--neon-blue);"></i> Soporte Técnico</div>
                                            <div class="custom-option" data-value="bug"><i class="fas fa-bug" style="color: var(--neon-pink);"></i> Reporte de Bug</div>
                                            <div class="custom-option" data-value="suggestion"><i class="fas fa-lightbulb" style="color: var(--neon-green);"></i> Sugerencia</div>
                                            <div class="custom-option" data-value="partnership"><i class="fas fa-handshake" style="color: var(--neon-cyan);"></i> Colaboración</div>
                                            <div class="custom-option" data-value="other"><i class="fas fa-ellipsis-h" style="color: #888;"></i> Otro</div>
                                        </div>
                                        <input type="hidden" id="contact-subject" required>
                                    </div>
                                    <div class="error-message">Selecciona un asunto.</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="field-header">
                                    <label>Mensaje</label>
                                    <span class="char-limit" id="limit-message">0 / 1000</span>
                                </div>
                                <textarea id="contact-message" placeholder="¿En qué podemos ayudarte?" style="min-height: 150px;" required minlength="20" maxlength="1000"></textarea>
                                <div class="error-message">Se requiere un mensaje más descriptivo (mín. 20 caracteres).</div>
                            </div>
                            <button type="submit" class="btn btn-red-gradient btn-full" id="submit-btn" style="margin-top: 1rem;">
                                <i class="fas fa-paper-plane"></i> ENVIAR MENSAJE A SOPORTE
                            </button>
                        </form>
                        
                        <!-- Overlay de Envío -->
                        <div id="sending-overlay" style="display: none; position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); border-radius: 20px; z-index: 10; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
                            <div class="loader-hologram"></div>
                            <h3 style="color: var(--neon-cyan); margin-top: 1rem;">ENVIANDO DATOS AL SERVIDOR...</h3>
                            <div style="width: 80%; height: 4px; background: #333; margin-top: 1rem; border-radius: 2px; overflow: hidden;">
                                <div id="sending-progress" style="width: 0%; height: 100%; background: var(--gradient-main); box-shadow: 0 0 10px var(--neon-cyan);"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Mi Panel de Soporte (Solo Logueados) -->
                    <div class="card" id="support-panel" style="display: none;">
                        <h2 class="mb-2">Mis Tickets <span id="ticket-count" class="badge">0</span></h2>
                        <div id="tickets-list" style="max-height: 400px; overflow-y: auto;">
                            <!-- Tickets dinámicos -->
                        </div>
                        <div class="mt-2 text-center">
                            <p style="font-size: 0.9rem; color: #888;">Los tickets tardan 24-48h en procesarse.</p>
                        </div>
                    </div>

                </div>
            </section>


        </div>
    </main>

    <!-- Layout System -->
    <script src="layout.js?v=UPDATE_SEARCH_REFACTOR_V1"></script>

    <script>
        // --- Gestión de Tickets (Mock) ---
        const SupportTickets = {
            storageKey: 'muzicmania_tickets',
            getAll: function() {
                return JSON.parse(localStorage.getItem(this.storageKey) || '[]');
            },
            save: function(ticket) {
                const tickets = this.getAll();
                tickets.unshift(ticket);
                localStorage.setItem(this.storageKey, JSON.stringify(tickets));
            },
            render: function() {
                const list = document.getElementById('tickets-list');
                const count = document.getElementById('ticket-count');
                const tickets = this.getAll();
                
                if (!list) return;
                
                count.textContent = tickets.length;
                
                if (tickets.length === 0) {
                    list.innerHTML = `<p style="text-align: center; color: #555; padding: 2rem;">No tienes tickets activos.</p>`;
                    return;
                }

                list.innerHTML = tickets.map(t => `
                    <div class="ticket-item">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="color: var(--neon-blue); font-weight: bold;">#${t.id}</span>
                            <span class="ticket-status status-${t.status.toLowerCase()}">${t.status}</span>
                        </div>
                        <div style="font-size: 0.95rem;">${t.subject}</div>
                        <div style="font-size: 0.8rem; color: #888;">${new Date(t.date).toLocaleDateString()}</div>
                    </div>
                `).join('');
            }
        };

        // --- Custom Dropdown Logic ---
        function setupCustomDropdown(id) {
            const container = document.getElementById(`container-${id}`);
            const trigger = document.getElementById(`trigger-${id}`);
            const options = document.getElementById(`options-${id}`);
            const input = document.getElementById(`contact-${id}`);
            
            if (!container || !trigger || !options || !input) return;

            trigger.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                // Cerrar otros dropdowns
                document.querySelectorAll('.custom-select-container').forEach(other => {
                    if (other !== container) other.classList.remove('active');
                });
                
                container.classList.toggle('active');
            });

            // Usar delegación de eventos para las opciones
            options.addEventListener('click', (e) => {
                const opt = e.target.closest('.custom-option');
                if (!opt) return;

                e.preventDefault();
                e.stopPropagation();
                
                const val = opt.getAttribute('data-value');
                input.value = val;
                
                // Actualizar UI del trigger
                trigger.querySelector('span').innerHTML = opt.innerHTML;
                
                // Marcar seleccionada
                options.querySelectorAll('.custom-option').forEach(o => o.classList.remove('selected'));
                opt.classList.add('selected');
                
                // Cerrar
                container.classList.remove('active');
                
                // Validar grupo
                const group = container.closest('.form-group');
                if (group) {
                    group.classList.remove('has-error');
                    const error = group.querySelector('.error-message');
                    if (error) error.style.display = 'none';
                }
                
                // Disparar evento
                input.dispatchEvent(new Event('input', { bubbles: true }));
            });
        }

        // Cerrar dropdowns al hacer click fuera
        window.addEventListener('click', (e) => {
            if (!e.target.closest('.custom-select-container')) {
                document.querySelectorAll('.custom-select-container').forEach(c => c.classList.remove('active'));
            }
        });

        // Dropdowns and counters will be initialized in initializeContactPage

        // --- Character Counter Logic ---
        function setupCharCounter(id, limitId, min, max) {
            const input = document.getElementById(id);
            const limit = document.getElementById(limitId);
            if (!input || !limit) return;

            const update = () => {
                const len = input.value.length;
                limit.textContent = `${len} / ${max}`;

                if (len === 0) {
                    limit.style.color = '#666';
                } else if (len < min || len > max) {
                    limit.style.color = 'var(--neon-pink)'; // Error
                    limit.style.textShadow = '0 0 5px rgba(255, 0, 128, 0.3)';
                } else if (len >= max * 0.9) {
                    limit.style.color = 'var(--neon-pink)'; // Casi lleno
                } else {
                    limit.style.color = 'var(--neon-cyan)'; // Válido
                    limit.style.textShadow = '0 0 5px rgba(0, 212, 255, 0.3)';
                }
            };

            input.addEventListener('input', update);
            update(); 
        }


        // --- Form Interaction & Validation ---
        document.getElementById('contact-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            let hasError = false;
            const inputs = this.querySelectorAll('input[required], textarea[required]');

            inputs.forEach(input => {
                const group = input.closest('.form-group');
                const error = group.querySelector('.error-message');
                let valid = input.checkValidity();

                if (input.type === 'hidden' && !input.value) {
                    valid = false;
                }

                if (!valid) {
                    group.classList.add('has-error');
                    if (error) error.style.display = 'block';
                    hasError = true;
                } else {
                    group.classList.remove('has-error');
                    if (error) error.style.display = 'none';
                }
            });

            if (hasError) return;
            
            const overlay = document.getElementById('sending-overlay');
            const progress = document.getElementById('sending-progress');
            const submitBtn = document.getElementById('submit-btn');
            
            overlay.style.display = 'flex';
            submitBtn.disabled = true;
            
            let p = 0;
            const interval = setInterval(() => {
                p += Math.random() * 20;
                if (p >= 100) {
                    p = 100;
                    clearInterval(interval);
                    
                    SupportTickets.save({
                        id: Math.random().toString(36).substr(2, 6).toUpperCase(),
                        subject: document.getElementById('trigger-subject').querySelector('span').innerText,
                        date: new Date().toISOString(),
                        status: 'PENDING'
                    });

                    setTimeout(() => {
                        overlay.style.display = 'none';
                        alert('¡Mensaje Enviado! Tu solicitud ha sido enviada al soporte técnico.');
                        this.reset();
                        // Trigger input events to refresh counters
                        this.querySelectorAll('input, textarea').forEach(i => i.dispatchEvent(new Event('input')));
                        
                        document.getElementById('trigger-country').querySelector('span').innerText = 'Selecciona tu país';
                        document.getElementById('trigger-subject').querySelector('span').innerText = 'Selecciona un asunto';
                        submitBtn.disabled = false;
                        progress.style.width = '0%';
                        SupportTickets.render();
                    }, 500);
                }
                progress.style.width = p + '%';
            }, 300);
        });


        // --- Auth Integration & Initializations ---
        let contactInitialized = false;

        function initializeContactPage() {
            if (typeof AuthSystem === 'undefined') {
                setTimeout(initializeContactPage, 100);
                return;
            }

            if (!contactInitialized) {
                // 1. Initialize Form Components FIRST
                setupCustomDropdown('country');
                setupCustomDropdown('subject');
                setupCharCounter('contact-real-name', 'limit-real-name', 2, 50);
                setupCharCounter('contact-name', 'limit-name', 3, 20);
                setupCharCounter('contact-email', 'limit-email', 5, 100);
                setupCharCounter('contact-message', 'limit-message', 20, 1000);
                contactInitialized = true;
                console.log("MuzicMania Contact System: Componentes Listos");
            }

            // 2. Auth Logic (Pre-fill)
            const user = AuthSystem.getCurrentUser();
            const guestPanel = document.getElementById('guest-panel');
            const supportPanel = document.getElementById('support-panel');

            if (user) {
                const name = document.getElementById('contact-name');
                const realName = document.getElementById('contact-real-name');
                const email = document.getElementById('contact-email');
                
                if (name) name.value = user.username;
                if (realName) realName.value = user.username;
                if (email) email.value = user.email || "usuario@muzicmania.game";
                
                // Trigger updates AFTER listeners are attached
                [name, realName, email].forEach(i => {
                    if (i) i.dispatchEvent(new Event('input'));
                });

                if (guestPanel) guestPanel.style.display = 'none';
                if (supportPanel) supportPanel.style.display = 'block';
                SupportTickets.render();
            } else {
                if (guestPanel) guestPanel.style.display = 'block';
                if (supportPanel) supportPanel.style.display = 'none';
            }
        }

        window.addEventListener('load', initializeContactPage);
        window.addEventListener('authChange', initializeContactPage);

    </script>
    <script src="auth.js?v=UPDATE_SEARCH_REFACTOR_V1"></script>
    <script src="utils.js?v=UPDATE_SEARCH_REFACTOR_V1"></script>
    <script src="search.js?v=UPDATE_SEARCH_REFACTOR_V1"></script>
    <script src="navigation.js?v=UPDATE_SEARCH_REFACTOR_V1"></script>
</body>
</html>
